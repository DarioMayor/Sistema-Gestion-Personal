<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor de Fichajes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    
    <style>
        body {
            background-color: #000038; 
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #standby-container {
            text-align: center;
            font-size: 2.0em; 
            color: #cccccc;
            animation: pulse 2.5s infinite ease-in-out;
            position: absolute;
            opacity: 1; 
            transition: opacity 0.5s ease;
        }

        #mensaje-container {
            text-align: center;
            border: 4px solid #333;
            padding: 40px 60px;
            border-radius: 15px;
            background-color: #2a2a2a;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: absolute; 
            opacity: 0; 
            transition: opacity 0.5s ease;
        }
        
        /* --- 1. AQUÍ AÑADIMOS EL ESTILO PARA EL LOGO --- */
        #logo-inti {
            position: fixed; /* Lo fija a la ventana del navegador */
            bottom: 15px;    /* A 15px del borde inferior */
            right: 25px;     /* A 25px del borde derecho */
            font-size: 3em;
            font-weight: bold;
            color: #cccccc;
            opacity: 1;    
        }
        /* --- Fin del estilo nuevo --- */

        h1 { font-size: 3.5em; margin: 0; }
        h2 { font-size: 2.5em; margin: 10px 0; }
        p { font-size: 1.8em; color: #aaa; }

        @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }
    </style>
</head>
<body>

    <div id="standby-container">
        <h1>Esperando huella...</h1>
    </div>

    <div id="mensaje-container">
        <h1 id="bienvenida"></h1>
        <h2 id="nombre"></h2>
        <h2 id="tipo"></h2>
        <p id="info-hora"></p>
    </div>

    <div id="logo-inti">
        INTI
    </div>


    <script>
        const standbyContainer = document.getElementById('standby-container');
        const container = document.getElementById('mensaje-container');
        
        const bienvenidaEl = document.getElementById('bienvenida');
        const nombreEl = document.getElementById('nombre');
        const tipoEl = document.getElementById('tipo');
        const infoHoraEl = document.getElementById('info-hora');
        
        let hideTimeout;
        
        function hideResultMessage() {
            container.style.opacity = '0';
            standbyContainer.style.opacity = '1';
            standbyContainer.style.animation = 'pulse 2.5s infinite ease-in-out';
        }

        function mostrarFichajeExitoso(datos) {
            const nombreCompleto = `${datos.nombre} ${datos.apellido}`;
            const tipoMensaje = `Fichaste la ${datos.tipo}`;
            const ts = new Date(datos.timestamp);
            const hora = ts.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const fecha = ts.toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit', year: 'numeric' });
            bienvenidaEl.textContent = (datos.tipo === 'salida') ? '¡Hasta luego!' : '¡Bienvenido!';
            nombreEl.textContent = nombreCompleto;
            tipoEl.textContent = tipoMensaje;
            infoHoraEl.innerHTML = `a las <span>${hora}</span> del día <span>${fecha}</span>`;
            tipoEl.style.color = (datos.tipo === 'salida') ? '#F44336' : '#4CAF50';

            standbyContainer.style.animation = 'none';
            standbyContainer.style.opacity = '0';
            container.style.opacity = '1';        
            
            clearTimeout(hideTimeout); 
            hideTimeout = setTimeout(hideResultMessage, 10000); 
        }

        function mostrarFichajeFallido() {
            bienvenidaEl.textContent = 'Error';
            nombreEl.textContent = 'Huella no reconocida';
            tipoEl.textContent = 'Por favor, intente de nuevo';
            infoHoraEl.innerHTML = ``; 
            tipoEl.style.color = '#F44336';

            standbyContainer.style.animation = 'none';
            standbyContainer.style.opacity = '0';
            container.style.opacity = '1';        

            clearTimeout(hideTimeout); 
            hideTimeout = setTimeout(hideResultMessage, 10000);
        }

        var socket = io();

        socket.on('nuevo_fichaje', function(datos) {
            console.log("¡Evento 'nuevo_fichaje' recibido!", datos);
            mostrarFichajeExitoso(datos);
        });

        socket.on('huella_no_reconocida', function() {
            console.log("¡Evento 'huella_no_reconocida' recibido!");
            mostrarFichajeFallido();
        });

        console.log("Monitor WebSocket listo y escuchando...");
    </script>

</body>
</html>